{"version":3,"sources":["flagrate/tokenizer.ts"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;EAcE;AACF,YAAY,CAAC;AAEb,OAAO,EAAE,QAAQ,EAAE,YAAY,EAAiB,MAAM,QAAQ,CAAC;AAC/D,OAAO,EAAE,OAAO,EAA0D,MAAM,WAAW,CAAC;AAC5F,OAAO,EAAE,MAAM,EAAE,MAAM,UAAU,CAAC;AAClC,OAAO,EAAE,IAAI,EAAE,MAAM,QAAQ,CAAC;AAC9B,OAAO,EAAE,SAAS,EAAE,MAAM,cAAc,CAAC;AA0FzC;;;;;;;;;;;;;;;;;;GAkBG;AACH,oBAAoB,SAAiB,EAAE;IAEnC,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,IAAI,EAAE,CAAC;IAClC,IAAI,CAAC,GAAG,GAAG,MAAM,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC;IAC5B,IAAI,CAAC,QAAQ,GAAG,MAAM,CAAC,QAAQ,IAAI,MAAM,CAAC,YAAY,IAAI,QAAQ,CAAC;IAEnE,EAAE,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC;QAClB,IAAI,CAAC,QAAQ,GAAG,MAAM,CAAC,QAAQ,CAAC;IACpC,CAAC;IAED,MAAM,IAAI,GAAG,MAAM,CAAC,SAAS,IAAI,EAAE,CAAC;IACpC,EAAE,CAAC,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC;QACZ,IAAI,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,EAAE,CAAC;IAC3B,CAAC;IAED,QAAQ;IACR,MAAM,SAAS,GAAG,IAAI,OAAO,CAAC,KAAK,EAAE,IAAI,CAAc,CAAC;IACxD,YAAY,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;IAE9B,SAAS,CAAC,YAAY,CAAC,6BAA6B,CAAC,CAAC;IACtD,EAAE,CAAC,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC;QACnB,SAAS,CAAC,YAAY,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;IAC7C,CAAC;IAED,SAAS,CAAC,OAAO,GAAG,IAAI,OAAO,CAAC,MAAM,CAAC,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;IAC5D,SAAS,CAAC,MAAM,GAAG,IAAI,SAAS,CAAC,EAAE,WAAW,EAAE,MAAM,CAAC,WAAW,EAAE,CAAC,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;IAE1F,EAAE,CAAC,CAAC,SAAS,CAAC,MAAM,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC,CAAC;QAChC,SAAS,CAAC,aAAa,EAAE,CAAC;IAC9B,CAAC;IAED,SAAS,CAAC,gBAAgB,CAAC,OAAO,EAAE,SAAS,CAAC,eAAe,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;IAE/E,SAAS,CAAC,MAAM,CAAC,gBAAgB,CAAC,SAAS,EAAE,SAAS,CAAC,iBAAiB,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;IAC1F,SAAS,CAAC,MAAM,CAAC,gBAAgB,CAAC,OAAO,EAAE,SAAS,CAAC,eAAe,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;IACtF,SAAS,CAAC,MAAM,CAAC,gBAAgB,CAAC,MAAM,EAAE,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;IAEpF,EAAE,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;QACf,SAAS,CAAC,QAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IACrC,CAAC;IACD,EAAE,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;QACd,SAAS,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;IACnC,CAAC;IAED,EAAE,CAAC,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,CAAC;QACpB,SAAS,CAAC,OAAO,EAAE,CAAC;IACxB,CAAC;IAED,MAAM,CAAC,SAAS,CAAC;AACrB,CAAC;AAED,MAAM,CAAC,MAAM,SAAS,GAAG,UAA0B,CAAC;AAEpD,MAAM,0BAA0B,MAAe;IAC3C,MAAM,CAAC,IAAI,SAAS,CAAC,MAAM,CAAC,CAAC;AACjC,CAAC;AAED,SAAS,CAAC,SAAS,GAAG;IAClB,OAAO;QAEH,IAAI,CAAC,YAAY,CAAC,mBAAmB,CAAC,CAAC;QACvC,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC;QAEtB,MAAM,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;IAChC,CAAC;IAED,MAAM;QAEF,IAAI,CAAC,eAAe,CAAC,mBAAmB,CAAC,CAAC;QAC1C,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC;QAErB,MAAM,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;IAChC,CAAC;IAED,SAAS;QACL,MAAM,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,mBAAmB,CAAC,CAAC;IACnD,CAAC;IAED,SAAS,CAAC,MAAM;QAEZ,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QAErB,MAAM,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;IAChC,CAAC;IAED,SAAS;QACL,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC;IACvB,CAAC;IAED,YAAY;QAER,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC;QAEjB,MAAM,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;IAChC,CAAC;IAED,WAAW,CAAC,KAAK;QAEb,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC;QAElD,MAAM,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;IAChC,CAAC;IAED,OAAO,CAAC,UAAU;QAEd,IAAI,CAAC,eAAe,GAAG,UAAU,CAAC;QAElC,EAAE,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC;YACb,IAAI,CAAC,YAAY,CAAC,eAAe,CAAC,CAAC,QAAQ,CAAC;gBACxC,eAAe,EAAE,OAAO,UAAU,GAAG;aACxC,CAAC,CAAC;QACP,CAAC;QAAC,IAAI,CAAC,CAAC;YACJ,IAAI,CAAC,eAAe,CAAC,eAAe,CAAC,CAAC,QAAQ,CAAC;gBAC3C,eAAe,EAAE,MAAM;aAC1B,CAAC,CAAC;QACP,CAAC;QAED,MAAM,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;IAChC,CAAC;IAED,OAAO;QACH,MAAM,CAAC,IAAI,CAAC,eAAe,IAAI,EAAE,CAAC;IACtC,CAAC;IAED,KAAK;QACD,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC;IACxB,CAAC;IAED,aAAa;QAET,MAAM,SAAS,GAAc,IAAI,CAAC;QAElC,SAAS,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC;QAE3B,SAAS,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK;YAE1B,IAAI,KAAK,CAAC;YAEV,EAAE,CAAC,CAAC,OAAO,KAAK,KAAK,QAAQ,CAAC,CAAC,CAAC;gBAC5B,KAAK,GAAG,KAAK,CAAC;YAClB,CAAC;YAAC,IAAI,CAAC,CAAC;gBACJ,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC;YACxB,CAAC;YAED,IAAI,MAAM,CAAC;gBACP,UAAU,EAAE,SAAS,CAAC,SAAS,EAAE,KAAK,KAAK;gBAC3C,iBAAiB,EAAE,SAAS,CAAC,SAAS,EAAE;gBACxC,QAAQ,EAAE,MAAM,SAAS,CAAC,WAAW,CAAC,KAAK,CAAC;gBAC5C,KAAK,EAAE,KAAK;aACf,CAAC,CAAC,QAAQ,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;QACnC,CAAC,CAAC,CAAC;QAEH,MAAM,EAAE,GAAG,SAAS,CAAC,QAAQ,EAAE,CAAC;QAChC,MAAM,EAAE,GAAG,SAAS,CAAC,QAAQ,CAAC,cAAc,CAAC,KAAK,IAAI,GAAG,CAAC,GAAG,QAAQ,CAAC,SAAS,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;QAChI,MAAM,EAAE,GAAG,SAAS,CAAC,QAAQ,CAAC,cAAc,CAAC,KAAK,IAAI,GAAG,CAAC,GAAG,QAAQ,CAAC,SAAS,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;QAChI,MAAM,EAAE,GAAG,SAAS,CAAC,QAAQ,CAAC,eAAe,CAAC,KAAK,IAAI,GAAG,CAAC,GAAG,QAAQ,CAAC,SAAS,CAAC,QAAQ,CAAC,eAAe,CAAC,CAAC,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;QAClI,MAAM,EAAE,GAAG,SAAS,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC;QACxC,MAAM,EAAE,GAAG,SAAS,CAAC,OAAO,CAAC,QAAQ,CAAC,aAAa,CAAC,KAAK,IAAI,GAAG,CAAC,GAAG,QAAQ,CAAC,SAAS,CAAC,OAAO,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;QAC9I,MAAM,EAAE,GAAG,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,aAAa,CAAC,KAAK,IAAI,GAAG,CAAC,GAAG,QAAQ,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;QAC5I,MAAM,EAAE,GAAG,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,cAAc,CAAC,KAAK,IAAI,GAAG,CAAC,GAAG,QAAQ,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;QAC9I,MAAM,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,EAAE,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;QAE3D,EAAE,CAAC,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;YACV,SAAS,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,GAAG,GAAG,EAAE,IAAI,CAAC;QAC7C,CAAC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;YACjB,SAAS,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,GAAG,EAAE,CAAC;QACtC,CAAC;QAAC,IAAI,CAAC,CAAC;YACJ,SAAS,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,GAAG,MAAM,CAAC;QAC1C,CAAC;QAED,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAEzB,MAAM,CAAC,IAAI,CAAC;IAChB,CAAC;IAED,SAAS;QAEL,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;QAEtB,MAAM,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC;QAE9B,MAAM,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,EAAE,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QAE9D,EAAE,CAAC,CAAC,MAAM,KAAK,KAAK,CAAC,CAAC,CAAC,CAAC;YACpB,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;QAC5B,CAAC;QAED,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC;QAE7C,MAAM,CAAC,IAAI,CAAC;IAChB,CAAC;IAED,UAAU,CAAC,UAAU;QAEjB,EAAE,CAAC,CAAC,UAAU,YAAY,KAAK,KAAK,KAAK,CAAC,CAAC,CAAC;YACxC,UAAU,GAAG,CAAC,UAAU,CAAC,CAAC;QAC9B,CAAC;QAED,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;QAEtB,MAAM,IAAI,GAAG,IAAI,IAAI,CAAC;YAClB,QAAQ,EAAE,MAAM,IAAI,CAAC,MAAM,EAAE;SAChC,CAAC,CAAC;QAEH,IAAI,CAAC,KAAK,CAAC,IAAI,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,UAAU,IAAI,CAAC;QAEhD,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,MAAM,EAAE,SAAS,EAAE,QAAQ,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC;YACrE,SAAS,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC;YAE1B,EAAE,CAAC,CAAC,OAAO,SAAS,KAAK,QAAQ,CAAC,CAAC,CAAC;gBAChC,EAAE,CAAC,CAAC,SAAS,KAAK,EAAE,CAAC,CAAC,CAAC;oBACnB,QAAQ,CAAC;gBACb,CAAC;gBACD,QAAQ,GAAG,EAAE,KAAK,EAAE,SAAS,EAAE,CAAC;YACpC,CAAC;YAAC,IAAI,CAAC,CAAC;gBACJ,QAAQ,GAAG,SAAS,CAAC;YACzB,CAAC;YAED,EAAE,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC;gBACpB,QAAQ,CAAC,SAAS,GAAG,QAAQ,CAAC,QAAQ,CAAC;YAC3C,CAAC;YAED,QAAQ,CAAC,QAAQ,GAAG,0BAA0B,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;YAEhE,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YACjC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QACxB,CAAC;QAED,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;YACb,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC;QACxB,CAAC;QAED,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC,CAAC;YAChC,IAAI,CAAC,MAAM,CAAC,EAAE,GAAG,EAAE,IAAI,EAAE,CAAC,CAAC;YAC3B,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;QACtB,CAAC;QAED,MAAM,CAAC,IAAI,CAAC;IAChB,CAAC;IAED,eAAe;QACX,IAAI,CAAC,KAAK,EAAE,CAAC;IACjB,CAAC;IAED,iBAAiB,CAAC,CAAC;QAEf,WAAW;QACX,EAAE,CAAC,CAAC,CAAC,CAAC,OAAO,KAAK,EAAE,IAAI,IAAI,CAAC,mBAAmB,KAAK,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;YACrE,CAAC,CAAC,eAAe,EAAE,CAAC;YACpB,CAAC,CAAC,cAAc,EAAE,CAAC;YAEnB,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC;YAE7C,IAAI,CAAC,SAAS,EAAE,CAAC;YAEjB,MAAM,CAAC;QACX,CAAC;QAED,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,WAAW,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC,CAAC;YACpD,EAAE,CAAC,CAAC;YACA,WAAW;YACX,CAAC,CAAC,CAAC,OAAO,KAAK,EAAE,CAAC;gBAClB,WAAW;gBACX,CAAC,CAAC,CAAC,OAAO,KAAK,EAAE,CACrB,CAAC,CAAC,CAAC;gBACC,CAAC,CAAC,eAAe,EAAE,CAAC;gBACpB,CAAC,CAAC,cAAc,EAAE,CAAC;gBAEnB,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,EAAE,CAAC;gBACvB,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,IAAI,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;oBAChD,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC1C,CAAC;gBACD,IAAI,CAAC,aAAa,EAAE,CAAC;gBAErB,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;oBAChB,IAAI,CAAC,QAAQ,EAAE,CAAC;gBACpB,CAAC;gBAED,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;oBACb,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC;gBACxB,CAAC;YACL,CAAC;QACL,CAAC;QAED,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,KAAK,EAAE,IAAI,IAAI,CAAC,MAAM,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC,CAAC;YACvD,EAAE,CAAC,CAAC;YACA,OAAO;YACP,CAAC,CAAC,CAAC,OAAO,KAAK,CAAC,CACpB,CAAC,CAAC,CAAC;gBACC,CAAC,CAAC,eAAe,EAAE,CAAC;gBACpB,CAAC,CAAC,cAAc,EAAE,CAAC;gBAEnB,MAAM,KAAK,GAAU,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;gBACvC,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,OAAO,KAAK,KAAK,QAAQ,GAAG,KAAK,GAAG,OAAO,KAAK,CAAC,KAAK,KAAK,QAAQ,GAAG,KAAK,CAAC,KAAK,GAAG,EAAE,CAAC;gBAE3G,IAAI,CAAC,aAAa,EAAE,CAAC;gBAErB,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;oBAChB,IAAI,CAAC,QAAQ,EAAE,CAAC;gBACpB,CAAC;gBAED,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;oBACb,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC;gBACxB,CAAC;YACL,CAAC;QACL,CAAC;QAED,UAAU,CAAC;YAEP,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,IAAI,IAAI,CAAC,GAAG,IAAI,IAAI,CAAC,MAAM,CAAC,MAAM,IAAI,IAAI,CAAC,MAAM,CAAC,KAAK,KAAK,EAAE,CAAC,CAAC,CAAC;gBAC9E,CAAC,CAAC,eAAe,EAAE,CAAC;gBAEpB,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,EAAE,CAAC;gBAEvB,MAAM,CAAC;YACX,CAAC;YAED,IAAI,CAAC,SAAS,EAAE,CAAC;QACrB,CAAC,EAAE,CAAC,CAAC,CAAC;IACV,CAAC;IAED,eAAe;QAEX,IAAI,CAAC,aAAa,EAAE,CAAC;QACrB,IAAI,CAAC,SAAS,EAAE,CAAC;QAEjB,IAAI,CAAC,YAAY,CAAC,0BAA0B,CAAC,CAAC;IAClD,CAAC;IAED,cAAc;QAEV,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,EAAE,CAAC;QACvB,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;YACb,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,GAAG,GAAG,CAAC;YAC/B,UAAU,CAAC,MAAM,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,EAAE,GAAG,CAAC,CAAC;QAC/C,CAAC;QAED,IAAI,CAAC,eAAe,CAAC,0BAA0B,CAAC,CAAC;IACrD,CAAC;CACJ,CAAC;AAEF,oCAAoC,SAAoB,EAAE,SAAgB;IAEtE,MAAM,CAAC,UAAU,CAAC;QAEd,EAAE,CAAC,CAAC,SAAS,CAAC,GAAG,GAAG,CAAC,IAAI,SAAS,CAAC,GAAG,GAAG,SAAS,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;YAC/D,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACrC,CAAC;QACD,SAAS,CAAC,aAAa,EAAE,CAAC;QAE1B,EAAE,CAAC,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC;YACrB,SAAS,CAAC,QAAQ,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;QAChC,CAAC;IACL,CAAC,CAAC;AACN,CAAC","file":"tokenizer.js","sourcesContent":["/*\r\n   Copyright 2016 Webnium\r\n\r\n   Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   you may not use this file except in compliance with the License.\r\n   You may obtain a copy of the License at\r\n\r\n       http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n   Unless required by applicable law or agreed to in writing, software\r\n   distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   See the License for the specific language governing permissions and\r\n   limitations under the License.\r\n*/\r\n\"use strict\";\r\n\r\nimport { identity, extendObject, emptyFunction } from \"./util\";\r\nimport { Element, Attribute, Property, FHTMLSpanElement, FHTMLDivElement } from \"./element\";\r\nimport { Button } from \"./button\";\r\nimport { Menu } from \"./menu\";\r\nimport { TextInput } from \"./text-input\";\r\n\r\n/*?\r\n    class flagrate.Tokenizer\r\n\r\n    #### Event\r\n\r\n    * `change`: when the tokens/values is changed.\r\n**/\r\nexport interface Tokenizer extends Instance, FHTMLDivElement { }\r\n\r\nexport interface Class {\r\n    new (option?: Option): Tokenizer;\r\n    prototype: Instance;\r\n}\r\n\r\nexport interface Instance {\r\n    disable(): this;\r\n    enable(): this;\r\n    isEnabled(): boolean;\r\n    setValues(values: (string | Value)[]): this;\r\n    getValues(): (string | Value)[];\r\n    removeValues(): this;\r\n    removeValue(value: string | Value): this;\r\n    setIcon(url?: string): this;\r\n    getIcon(): string;\r\n    focus(): void;\r\n\r\n    onChange?(event?: any, tokenizer?: this): void;\r\n    values?: (string | Value)[];\r\n    max?: number;\r\n\r\n    _updateTokens(): this;\r\n    _tokenize(): this;\r\n    _tokenized(candidates: (string | Value)[]): this;\r\n    _tokenized(candidates: string | Value): this;\r\n    _onClickHandler(event: MouseEvent): void;\r\n    _onKeydownHandler(event: KeyboardEvent): void;\r\n    _onFocusHandler(event: FocusEvent): void;\r\n    _onBlurHandler(event: FocusEvent): void;\r\n\r\n    _tokens?: FHTMLSpanElement;\r\n    _input?: TextInput;\r\n}\r\n\r\nexport interface Option {\r\n    /** id attribute. */\r\n    id?: string;\r\n\r\n    /** class attribute. */\r\n    className?: string;\r\n\r\n    /** attribute/value pairs properties. */\r\n    attribute?: Attribute;\r\n\r\n    /** CSS style properties (uses Flagrate.Element.setStyle). */\r\n    style?: Property;\r\n\r\n    /** default values. */\r\n    values?: Value[];\r\n\r\n    /** default is `-1`. */\r\n    max?: number;\r\n\r\n    /** placeholder. */\r\n    placeholder?: string;\r\n\r\n    /** icon image URL. */\r\n    icon?: string;\r\n\r\n    /** default is Flagrate.identity */\r\n    tokenize?(input: string, done: TokenizedCallback): void;\r\n    tokenizeSync?(input: string): (string | Value)[];\r\n\r\n    /** default is false. */\r\n    isDisabled?: boolean;\r\n\r\n    onChange?(event?: any, tokenizer?: Tokenizer): void;\r\n}\r\n\r\nexport interface TokenizedCallback {\r\n    (output: (string | Value)[]): void;\r\n    (output: string | Value): void;\r\n}\r\n\r\nexport interface Value {\r\n    label: string;\r\n    value: any;\r\n}\r\n\r\n/*?\r\n    flagrate.createTextInput(option)\r\n    new flagrate.TextInput(option)\r\n    - option (Object) - options.\r\n\r\n    TextInput.\r\n\r\n    #### option\r\n\r\n    * `id`                       (String): `id` attribute of `input` element.\r\n    * `className`                (String):\r\n    * `attribute`                (Object):\r\n    * `style`                    (Object): (using flagrate.Element.setStyle)\r\n    * `value`                    (String):\r\n    * `placeholder`              (String):\r\n    * `icon`                     (String):\r\n    * `regexp`                   (RegExp):\r\n    * `isDisabled`               (Boolean; default `false`):\r\n**/\r\nfunction FTokenizer(option: Option = {}) {\r\n\r\n    this.values = option.values || [];\r\n    this.max = option.max || -1;\r\n    this.tokenize = option.tokenize || option.tokenizeSync || identity;\r\n\r\n    if (option.onChange) {\r\n        this.onChange = option.onChange;\r\n    }\r\n\r\n    const attr = option.attribute || {};\r\n    if (option.id) {\r\n        attr[\"id\"] = option.id;\r\n    }\r\n\r\n    //create\r\n    const tokenizer = new Element(\"div\", attr) as Tokenizer;\r\n    extendObject(tokenizer, this);\r\n\r\n    tokenizer.addClassName(\"flagrate flagrate-tokenizer\");\r\n    if (option.className) {\r\n        tokenizer.addClassName(option.className);\r\n    }\r\n\r\n    tokenizer._tokens = new Element(\"span\").insertTo(tokenizer);\r\n    tokenizer._input = new TextInput({ placeholder: option.placeholder }).insertTo(tokenizer);\r\n\r\n    if (tokenizer.values.length !== 0) {\r\n        tokenizer._updateTokens();\r\n    }\r\n\r\n    tokenizer.addEventListener(\"click\", tokenizer._onClickHandler.bind(tokenizer));\r\n\r\n    tokenizer._input.addEventListener(\"keydown\", tokenizer._onKeydownHandler.bind(tokenizer));\r\n    tokenizer._input.addEventListener(\"focus\", tokenizer._onFocusHandler.bind(tokenizer));\r\n    tokenizer._input.addEventListener(\"blur\", tokenizer._onBlurHandler.bind(tokenizer));\r\n\r\n    if (option.style) {\r\n        tokenizer.setStyle(option.style);\r\n    }\r\n    if (option.icon) {\r\n        tokenizer.setIcon(option.icon);\r\n    }\r\n\r\n    if (option.isDisabled) {\r\n        tokenizer.disable();\r\n    }\r\n\r\n    return tokenizer;\r\n}\r\n\r\nexport const Tokenizer = FTokenizer as any as Class;\r\n\r\nexport function createTokenizer(option?: Option): Tokenizer {\r\n    return new Tokenizer(option);\r\n}\r\n\r\nTokenizer.prototype = {\r\n    disable() {\r\n\r\n        this.addClassName(\"flagrate-disabled\");\r\n        this._input.disable();\r\n\r\n        return this._updateTokens();\r\n    },\r\n\r\n    enable() {\r\n\r\n        this.removeClassName(\"flagrate-disabled\");\r\n        this._input.enable();\r\n\r\n        return this._updateTokens();\r\n    },\r\n\r\n    isEnabled() {\r\n        return !this.hasClassName(\"flagrate-disabled\");\r\n    },\r\n\r\n    setValues(values) {\r\n\r\n        this.values = values;\r\n\r\n        return this._updateTokens();\r\n    },\r\n\r\n    getValues() {\r\n        return this.values;\r\n    },\r\n\r\n    removeValues() {\r\n\r\n        this.values = [];\r\n\r\n        return this._updateTokens();\r\n    },\r\n\r\n    removeValue(value) {\r\n\r\n        this.values.splice(this.values.indexOf(value), 1);\r\n\r\n        return this._updateTokens();\r\n    },\r\n\r\n    setIcon(identifier) {\r\n\r\n        this._iconIdentifier = identifier;\r\n\r\n        if (identifier) {\r\n            this.addClassName(\"flagrate-icon\").setStyle({\r\n                backgroundImage: `url(${identifier})`\r\n            });\r\n        } else {\r\n            this.removeClassName(\"flagrate-icon\").setStyle({\r\n                backgroundImage: \"none\"\r\n            });\r\n        }\r\n\r\n        return this._updateTokens();\r\n    },\r\n\r\n    getIcon() {\r\n        return this._iconIdentifier || \"\";\r\n    },\r\n\r\n    focus() {\r\n        this._input.focus();\r\n    },\r\n\r\n    _updateTokens() {\r\n\r\n        const tokenizer: Tokenizer = this;\r\n\r\n        tokenizer._tokens.update();\r\n\r\n        tokenizer.values.forEach(value => {\r\n\r\n            let label;\r\n\r\n            if (typeof value === \"string\") {\r\n                label = value;\r\n            } else {\r\n                label = value.label;\r\n            }\r\n\r\n            new Button({\r\n                isDisabled: tokenizer.isEnabled() === false,\r\n                isRemovableByUser: tokenizer.isEnabled(),\r\n                onRemove: () => tokenizer.removeValue(value),\r\n                label: label\r\n            }).insertTo(tokenizer._tokens);\r\n        });\r\n\r\n        const vw = tokenizer.getWidth();\r\n        const bw = tokenizer.getStyle(\"border-width\") === null ? 2 : parseInt(tokenizer.getStyle(\"border-width\").replace(\"px\", \"\"), 10);\r\n        const pl = tokenizer.getStyle(\"padding-left\") === null ? 4 : parseInt(tokenizer.getStyle(\"padding-left\").replace(\"px\", \"\"), 10);\r\n        const pr = tokenizer.getStyle(\"padding-right\") === null ? 4 : parseInt(tokenizer.getStyle(\"padding-right\").replace(\"px\", \"\"), 10);\r\n        const tw = tokenizer._tokens.getWidth();\r\n        const tm = tokenizer._tokens.getStyle(\"margin-left\") === null ? 2 : parseInt(tokenizer._tokens.getStyle(\"margin-left\").replace(\"px\", \"\"), 10);\r\n        const im = tokenizer._input.getStyle(\"margin-left\") === null ? 2 : parseInt(tokenizer._input.getStyle(\"margin-left\").replace(\"px\", \"\"), 10);\r\n        const ip = tokenizer._input.getStyle(\"padding-left\") === null ? 2 : parseInt(tokenizer._input.getStyle(\"padding-left\").replace(\"px\", \"\"), 10);\r\n        const aw = vw - pl - pr - tw - tm - im - ip - (bw * 2) - 2;\r\n\r\n        if (aw > 30) {\r\n            tokenizer._input.style.width = `${aw}px`;\r\n        } else if (aw < -5) {\r\n            tokenizer._input.style.width = \"\";\r\n        } else {\r\n            tokenizer._input.style.width = \"100%\";\r\n        }\r\n\r\n        tokenizer.fire(\"change\");\r\n\r\n        return this;\r\n    },\r\n\r\n    _tokenize() {\r\n\r\n        this._candidates = [];\r\n\r\n        const str = this._input.value;\r\n\r\n        const result = this.tokenize(str, this._tokenized.bind(this));\r\n\r\n        if (result !== void 0) {\r\n            this._tokenized(result);\r\n        }\r\n\r\n        this._lastTokenizedValue = this._input.value;\r\n\r\n        return this;\r\n    },\r\n\r\n    _tokenized(candidates) {\r\n\r\n        if (candidates instanceof Array === false) {\r\n            candidates = [candidates];\r\n        }\r\n\r\n        this._candidates = [];\r\n\r\n        const menu = new Menu({\r\n            onSelect: () => menu.remove()\r\n        });\r\n\r\n        menu.style.left = `${this._input.offsetLeft}px`;\r\n\r\n        for (let i = 0, l = candidates.length, candidate, menuItem; i < l; i++) {\r\n            candidate = candidates[i];\r\n\r\n            if (typeof candidate === \"string\") {\r\n                if (candidate === \"\") {\r\n                    continue;\r\n                }\r\n                menuItem = { label: candidate };\r\n            } else {\r\n                menuItem = candidate;\r\n            }\r\n\r\n            if (menuItem.onSelect) {\r\n                menuItem._onSelect = menuItem.onSelect;\r\n            }\r\n\r\n            menuItem.onSelect = _createMenuOnSelectHandler(this, candidate);\r\n\r\n            this._candidates.push(candidate);\r\n            menu.push(menuItem);\r\n        }\r\n\r\n        if (this._menu) {\r\n            this._menu.remove();\r\n        }\r\n\r\n        if (this._candidates.length !== 0) {\r\n            this.insert({ top: menu });\r\n            this._menu = menu;\r\n        }\r\n\r\n        return this;\r\n    },\r\n\r\n    _onClickHandler() {\r\n        this.focus();\r\n    },\r\n\r\n    _onKeydownHandler(e) {\r\n\r\n        // ENTER:13\r\n        if (e.keyCode === 13 && this._lastTokenizedValue !== this._input.value) {\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n\r\n            this._lastTokenizedValue = this._input.value;\r\n\r\n            this._tokenize();\r\n\r\n            return;\r\n        }\r\n\r\n        if (this._candidates && this._candidates.length !== 0) {\r\n            if (\r\n                // ENTER:13\r\n                (e.keyCode === 13) ||\r\n                // right:39\r\n                (e.keyCode === 39)\r\n            ) {\r\n                e.stopPropagation();\r\n                e.preventDefault();\r\n\r\n                this._input.value = \"\";\r\n                if (this.max < 0 || this.max > this.values.length) {\r\n                    this.values.push(this._candidates[0]);\r\n                }\r\n                this._updateTokens();\r\n\r\n                if (this.onChange) {\r\n                    this.onChange();\r\n                }\r\n\r\n                if (this._menu) {\r\n                    this._menu.remove();\r\n                }\r\n            }\r\n        }\r\n\r\n        if (this._input.value === \"\" && this.values.length !== 0) {\r\n            if (\r\n                // BS:8\r\n                (e.keyCode === 8)\r\n            ) {\r\n                e.stopPropagation();\r\n                e.preventDefault();\r\n\r\n                const value: Value = this.values.pop();\r\n                this._input.value = typeof value === \"string\" ? value : typeof value.value === \"string\" ? value.value : \"\";\r\n\r\n                this._updateTokens();\r\n\r\n                if (this.onChange) {\r\n                    this.onChange();\r\n                }\r\n\r\n                if (this._menu) {\r\n                    this._menu.remove();\r\n                }\r\n            }\r\n        }\r\n\r\n        setTimeout(() => {\r\n\r\n            if (this.max > -1 && this.max <= this.values.length && this._input.value !== \"\") {\r\n                e.stopPropagation();\r\n\r\n                this._input.value = \"\";\r\n\r\n                return;\r\n            }\r\n\r\n            this._tokenize();\r\n        }, 0);\r\n    },\r\n\r\n    _onFocusHandler() {\r\n\r\n        this._updateTokens();\r\n        this._tokenize();\r\n\r\n        this.addClassName(\"flagrate-tokenizer-focus\");\r\n    },\r\n\r\n    _onBlurHandler() {\r\n\r\n        this._input.value = \"\";\r\n        if (this._menu) {\r\n            this._menu.style.opacity = \"0\";\r\n            setTimeout(() => this._menu.remove(), 500);\r\n        }\r\n\r\n        this.removeClassName(\"flagrate-tokenizer-focus\");\r\n    }\r\n};\r\n\r\nfunction _createMenuOnSelectHandler(tokenizer: Tokenizer, candidate: Value) {\r\n\r\n    return function (e) {\r\n\r\n        if (tokenizer.max < 0 || tokenizer.max > tokenizer.values.length) {\r\n            tokenizer.values.push(candidate);\r\n        }\r\n        tokenizer._updateTokens();\r\n\r\n        if (tokenizer.onChange) {\r\n            tokenizer.onChange(e, this);\r\n        }\r\n    };\r\n}"]}