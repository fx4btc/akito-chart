{"version":3,"sources":["flagrate/pulldown.ts"],"names":[],"mappings":"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","file":"pulldown.js","sourcesContent":["/*\r\n   Copyright 2016 Webnium\r\n\r\n   Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   you may not use this file except in compliance with the License.\r\n   You may obtain a copy of the License at\r\n\r\n       http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n   Unless required by applicable law or agreed to in writing, software\r\n   distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   See the License for the specific language governing permissions and\r\n   limitations under the License.\r\n*/\r\n\"use strict\";\r\n\r\nimport { extendObject, emptyFunction } from \"./util\";\r\nimport { Element, Attribute, Property, FHTMLDivElement }  from \"./element\";\r\nimport { Button, ButtonEvent }  from \"./button\";\r\nimport { Menu, ItemOption }  from \"./menu\";\r\n\r\n/*?\r\n    class flagrate.Pulldown\r\n\r\n    #### Example\r\n\r\n        var menu = flagrate.createPulldown({\r\n            label: \"foo\",\r\n            items: [\r\n                {\r\n                    label: \"bar\"\r\n                }\r\n            ]\r\n        }).insertTo(x);\r\n\r\n    #### Structure\r\n\r\n        <button class=\"flagrate flagrate-button flagrate-pulldown\">\r\n            \"foo\"\r\n            <span class=\"flagrate-pulldown-triangle\"></span>\r\n        </button>\r\n        <div class=\"flagrate-pulldown-menu flagrate flagrate-menu\">\r\n            <button class=\"flagrate flagrate-button\">bar</button>\r\n        </div>\r\n\r\n    menu `div` are created with flagrate.Menu\r\n\r\n    #### Events\r\n\r\n    * `select`:\r\n    * `open`:\r\n    * `close`:\r\n\r\n    #### Inheritances\r\n\r\n    * flagrate.Element\r\n    * flagrate.Button\r\n    * flagrate.Menu\r\n**/\r\nexport interface Pulldown extends Instance, Button { }\r\n\r\nexport interface Class {\r\n    new (option?: Option): Pulldown;\r\n    prototype: Instance;\r\n}\r\n\r\nexport interface Instance {\r\n    items?: ItemOption[];\r\n\r\n    open(event?: any): this;\r\n    close(event?: any): this;\r\n\r\n    onOpen?(event?: ButtonEvent, button?: this): void;\r\n    onClose?(event?: ButtonEvent, button?: this): void;\r\n\r\n    _menu?: FHTMLDivElement;\r\n    _open?: boolean;\r\n}\r\n\r\nexport interface Option {\r\n    /** id attribute. */\r\n    id?: string;\r\n\r\n    /** class attribute. */\r\n    className?: string;\r\n\r\n    /** attribute/value pairs properties. */\r\n    attribute?: Attribute;\r\n\r\n    /** CSS style properties (uses flagrate.Element.setStyle). */\r\n    style?: Property;\r\n\r\n    /** Color (uses flagrate.Button#setColor). */\r\n    color?: string;\r\n\r\n    /** Label text. */\r\n    label?: string;\r\n\r\n    /** icon image URL. */\r\n    icon?: string;\r\n\r\n    /** default is false. */\r\n    isDisabled?: boolean;\r\n\r\n    /** Button items */\r\n    items?: ItemOption[];\r\n\r\n    onSelect?(event?: ButtonEvent, button?: Pulldown): void;\r\n    onOpen?(event?: any, button?: Pulldown): void;\r\n    onClose?(event?: any, button?: Pulldown): void;\r\n}\r\n\r\n/*?\r\n    flagrate.createPulldown(option)\r\n    new flagrate.Pulldown(option)\r\n    - option (Object) - options.\r\n\r\n    Pulldown.\r\n\r\n    #### option\r\n\r\n    * `id`                       (String): `id` attribute of `button` element.\r\n    * `className`                (String):\r\n    * `attribute`                (Object):\r\n    * `style`                    (Object): (using flagrate.Element.setStyle)\r\n    * `items`                    (Array): of item (see: flagrate.Menu)\r\n    * `isDisabled`               (Boolean; default `false`):\r\n    * `onSelect`                 (Function):\r\n    * `onOpen`                   (Function):\r\n    * `onClose`                  (Function):\r\n**/\r\nfunction FPulldown(option: Option = {}) {\r\n\r\n    option.label = option.label || \"\";\r\n\r\n    this.items = option.items || [];\r\n\r\n    this.onOpen = option.onOpen || emptyFunction;\r\n    this.onClose = option.onClose || emptyFunction;\r\n\r\n    const attr = option.attribute || {};\r\n    if (option.id) {\r\n        attr[\"id\"] = option.id;\r\n    }\r\n\r\n    //create\r\n    const pulldown = <Pulldown>new Button({\r\n        attribute: attr,\r\n        label: option.label,\r\n        icon: option.icon,\r\n        onSelect: option.onSelect\r\n    });\r\n\r\n    extendObject(pulldown, this);\r\n\r\n    pulldown.addEventListener(\"select\", pulldown.open.bind(pulldown));\r\n\r\n    pulldown.addClassName(\"flagrate-pulldown\");\r\n    if (option.className) {\r\n        pulldown.addClassName(option.className);\r\n    }\r\n\r\n    new Element(\"span\", { \"class\": \"flagrate-pulldown-triangle\" }).insertTo(pulldown);\r\n\r\n    if (option.style) {\r\n        pulldown.setStyle(option.style);\r\n    }\r\n    if (option.color) {\r\n        pulldown.setColor(option.color);\r\n    }\r\n\r\n    if (option.isDisabled) {\r\n        pulldown.disable();\r\n    }\r\n\r\n    return pulldown;\r\n}\r\n\r\nexport const Pulldown = FPulldown as any as Class;\r\n\r\nexport function createPulldown(option?: Option): Pulldown {\r\n    return new Pulldown(option);\r\n}\r\n\r\nPulldown.prototype = {\r\n    open(e) {\r\n\r\n        const pulldown = this as Pulldown;\r\n\r\n        if (pulldown._open === true || !!pulldown._menu) {\r\n            pulldown.close();\r\n            return;\r\n        }\r\n\r\n        pulldown._open = true;\r\n\r\n        pulldown._menu = new Element(\"div\", {\"class\": \"flagrate-pulldown-menu\"})\r\n            .insert(\r\n                new Menu({\r\n                    items: pulldown.items,\r\n                    onSelect: (e) => {\r\n\r\n                        if (pulldown.onSelect) {\r\n                            pulldown.onSelect(e, pulldown);\r\n                        }\r\n\r\n                        pulldown.fire(\"select\", { targetPulldown: pulldown });\r\n                    }\r\n                })\r\n            );\r\n\r\n        pulldown._menu.style.top = `${pulldown.offsetTop + pulldown.getHeight()}px`;\r\n        pulldown._menu.style.left = `${pulldown.offsetLeft}px`;\r\n\r\n        pulldown.insert({ after: pulldown._menu });\r\n\r\n        // To prevent overflow.\r\n        let menuHeight = pulldown._menu.getHeight();\r\n        let menuMargin = parseInt(pulldown._menu.getStyle(\"margin-top\").replace(\"px\", \"\"), 10);\r\n        let cummOffsetTop = pulldown.cumulativeOffset().top;\r\n        let upsideSpace = - window.pageYOffset + cummOffsetTop;\r\n        let downsideSpace = window.pageYOffset + window.innerHeight - cummOffsetTop - pulldown.getHeight();\r\n        if (menuHeight + menuMargin > downsideSpace) {\r\n            if (upsideSpace > downsideSpace) {\r\n                if (upsideSpace < menuHeight + menuMargin) {\r\n                    menuHeight = (upsideSpace - menuMargin - menuMargin);\r\n                    pulldown._menu.style.maxHeight = `${menuHeight}px`;\r\n                }\r\n                pulldown._menu.style.top = `${(pulldown.offsetTop - menuHeight - (menuMargin * 2))}px`;\r\n            } else {\r\n                menuHeight = (downsideSpace - menuMargin - menuMargin);\r\n                pulldown._menu.style.maxHeight = `${menuHeight}px`;\r\n            }\r\n        }\r\n\r\n        const close = (e: Event) => {\r\n\r\n            document.body.removeEventListener(\"click\", close);\r\n            if (pulldown.parentNode) {\r\n                pulldown.parentNode.removeEventListener(\"click\", close);\r\n            }\r\n            pulldown.removeEventListener(\"select\", close);\r\n\r\n            pulldown.close(e);\r\n        };\r\n\r\n        setTimeout(() => {\r\n            document.body.addEventListener(\"click\", close);\r\n            if (pulldown.parentNode) {\r\n                pulldown.parentNode.addEventListener(\"click\", close);\r\n            }\r\n            pulldown.addEventListener(\"select\", close);\r\n        }, 0);\r\n\r\n        pulldown.onOpen.call(pulldown, e, pulldown);\r\n        pulldown.fire(\"open\", { targetPulldown: pulldown });\r\n\r\n        return this;\r\n    },\r\n\r\n    close(e) {\r\n\r\n        const pulldown = this as Pulldown;\r\n\r\n        if (pulldown._open === false || !pulldown._menu) {\r\n            return;\r\n        }\r\n\r\n        pulldown._open = false;\r\n\r\n        pulldown._menu.style.opacity = \"0\";\r\n\r\n        setTimeout(() => {\r\n\r\n            if (!pulldown._menu) {\r\n                return;\r\n            }\r\n\r\n            pulldown._menu.remove();\r\n            delete pulldown._menu;\r\n\r\n            pulldown.onClose(e, pulldown);\r\n            pulldown.fire(\"close\", { targetPulldown: pulldown });\r\n        }, 250);\r\n\r\n        return this;\r\n    }\r\n};"]}